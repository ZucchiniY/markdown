---
title: 在 A 股回测周内效应
icons:
  - fas fa-fire red
  - fas fa-star green
tags:
  - backtrader
  - 周内效应
  - python
categories:
  - 后台技术
  - Python
keywords:
  - 周内效应
  - 基金回测
description: 使用 Backtrader 回测场内指数基金的周内效应。
abbrlink: 6501720c
date: 2021-07-08 16:37:35
updated: 2021-07-09 16:37:35
---

## 背景

在学习回测技术的时候，看到了一篇 **周内效应** 的文章，主要说的是关于国内大 A 的一个效应，看起来就一周内的每天都有涨跌的趋势，可以利用这个趋势进行买卖股票。

文章中给的这个策略的净值达到了 41.45，年化率是 28.78%，最大回撤 34.99% 。

## 结论

在文章的最终，作者给出了一个周内效应的归纳，如下：

> 若今日收盘价高于20日均线则为牛市，否则为熊市。
> 牛市中，周一和周五表现较好，周二和周四表现较差。
> 熊市中，周二和周三表现较好，周一和周四表现较差。

然后依据这个效应，作者进行了一个针对沪深 300 的回测，年化达到了 28.7% ，而回撤只有 34.99% ，这个是完全高于沪深 300 的指数的，而且于长红的 **富国天惠成长混合 161005** 差不多了，可能回撤相对高一些。

具体的操作思路如下：

> 牛市
> 下个交易日为周一或周五则买入
> 下个交易日为周二或周四则卖出
> 熊市
> 下个交易日为周二或周三则买入
> 下个交易日为周一或周四则卖出

## 构建复盘

### 场内基金选择

因为是针对沪深 300 的操作，所以选择的是 510300 这支基金，看一下开始的时间为 2012 年 5 月 4 日。

其它还有一些基金的规模不够大，或者是时间相对比较短，选就要选最大的一支。

为了复测这个效果是否合理，再选择两支基金进行测试，一支选择与深沪 300 同源的中证 500 的指数，510500 ，另外一支选择创业板 159915 这支 ETF。

首先准备数据，从 Akshare 上下载对应的数据文件。

```python 下载ETF基金
fund_detail = ak.fund_etf_hist_sina(symbol=etf_fund_code)
```

然后将三支基金的数据文件下载下来，分别是 **sz159915 创业板** 、**sh510300 沪深 300** 和 **sh510500 中证 500** 三支基金。

然后编写回测用的程序。

```python 回测逻辑
def next(self):
    if self.price[0] >= self.sma[0]:
        "牛市"
        if self.weekday(self.datas[0].datetime.date(0)) in (4, 3):
            self.order = self.order_target_percent(data=self.datas[0],
                                                   target=0.98)
        if self.weekday(self.datas[0].datetime.date(0)) in (0, 2):
            self.order_target_percent(data=self.datas[0], target=0)
    else:
        "熊市"
        if self.weekday(self.datas[0].datetime.date(0)) in (0, 1):
            self.order = self.order_target_percent(data=self.datas[0],
                                                   target=0.98)
        if self.weekday(self.datas[0].datetime.date(0)) in (4, 2):
            self.order = self.order_target_percent(data=self.datas[0],
                                                   target=0)
```

因为示例给的是从 2006 年开始做的测试，但是时间太久了，可能更希望看最近几年的简略如何，将开始时间修改到 2015 年 4 月 15 日测试了一下，其实不是特别好，至少比我之前使用的动量策略、动量钟摆策略都要差。

> 为什么选择 2015 年 4 月 15 日
> 主要是因为 akshare 上的中证 500 的数据在这个时间点之前是有问题的，回测之后发现收益率达到了 35 倍，这显然是不可能的。所以查看了一下数据，可能是中间编制修改过，但是价格没有重新计算导致有问题。
> 后面把这三支基金都换成指数来测试一下，应该会更加准确。

当然也有可能我的选择不是特别合理，可以把开始时间拉到 2006 年开始，但是这就需要按指数进行测试，不能使用场内基金。后面完成了，会增加回测代码的。

初始资金 140000.00 。

| 场内基金 | 资产总值  | 总利润   | 投资回报率 | 夏普指数 | 最大回撤周期 | 最大回撤 | 最大回撤资金 |
|----------|-----------|----------|------------|----------|--------------|----------|--------------|
| 创业板   | 176533.98 | 36533.98 | 0.26       | 0.22     | 1124         | 42.99    | 68328.84     |
| 沪深300  | 212969.75 | 72969.75 | 0.52       | 0.46     | 320          | 29.83    | 51248.03     |
| 中证500  | 198141.46 | 58141.46 | 0.42       | 0.35     | 1131         | 35.6     | 61531.16     |

又修改了一下代码，增加了一些功能，实现了指数数据的回测，还是用的这三个指数，时间范围从 2010 年 6 月 1 日到 2021 年 7 月 8 日的数据。

| 指数    | 资产总值   | 总利润     | 投资回报率 | 夏普指数 | 最大回撤周期 | 最大回撤 | 最大回撤资金 |
|---------|------------|------------|------------|----------|--------------|----------|--------------|
| 创业板  | 1254578.27 | 1114578.27 | 7.96       | 0.78     | 916          | 27.75    | 312852.16    |
| 沪深300 | 701822.57  | 561822.57  | 4.01       | 0.80     | 312          | 22.72    | 118498.77    |
| 中证500 | 932812.03  | 792812.03  | 5.66       | 0.87     | 1126         | 34.79    | 261791.33    |

看数据要比使用 ETF 基金进行回测要好太多了，这个就有点奇怪了，于是把时间拉到和 ETF 相同的时间，结果就基本上差不多了，可以发现，到后面之后，指数的周内效应收益就很一般了。
